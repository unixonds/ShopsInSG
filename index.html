<!DOCTYPE html>
<!-- Stable version-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Footopia Self Order</title>
    <script src="util.js"></script>
    <style>
      @keyframes showMessage {
        0% {
          opacity: 0.8;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes moveShrink {
        0% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(100vw, -100vh) scale(0.05);
        }
        100% {
          transform: translate(0, 0) scale(1);
        }
      }
      @keyframes marquee {
          0% {
              transform: translateX(0%);
          }
          100% {
              transform: translateX(-100%);
          }
      }
      #announcement {
        padding: 1%;
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: Arial, sans-serif;
      }
      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0px;
        box-sizing: border-box;
        background-color: #111;
        position: relative;
        color: #fff;
      }
  
      button {
        display: inline-block;
        color: #fff;
        padding: 10px 20px;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        cursor: pointer;
        border: 2px solid #3498db;
        background: #d00;
        border-radius: 12px;
        transition: background-color 0.3s, color 0.3s;
      }
  
      button:hover {
        background-color: #3498db;
        color: #ffffff;
      }
      #cart {
        display: none;
        /* position: fixed; */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
      }
      #cart-icon {
          position: fixed;
          top: 20px;
          right: 10px;
          background-image: url(images/cart.svg);
          background-size: 2.8rem 2.8rem;
          background-color: #3498db; 
          background-position: center center;
          background-repeat: no-repeat;
          color: yellow;
          padding: 8px;
          border-radius: 50%;
          cursor: pointer;
          width: 3rem; 
          height: 3rem;
          z-index: 1; /* Ensure it's above other content */
      }
      
      /* New styles for the checkout view within the cart */
      .cart-header-buttons {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding: 0 10px;
      }

      #cart-close {
        position: fixed; 
        top: 0;
        right: 0;
        font-size: 2.5rem;
        color: red;
        background-color: #444;
        z-index: 3;
        border-radius: 50%;
        padding: 5px 20px;
        cursor: pointer;
        border: none; /* Remove default button border */
      }

      #send-order-btn {
        background-color: #28a745; /* Green color for send order */
        border: 2px solid #28a745;
        padding: 10px 15px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 8px;
      }
      #send-order-btn:hover {
        background-color: #218838;
      }

      #cart-container {
        display: flex;
        flex-wrap: wrap;
      }
      /* For first to maintain*/
      #cart-title {
        margin-right: 30px;
        margin-bottom: 10px;
      }
      #cart-icon:hover {
        background-color: #294089;
      }
      /*Value Inside cart icon*/
      #cart-count {
        display: inline-block;
        background-color: #810;
        color: #ccc;
        font-size: 12px;
        padding: 2px 5px;
        border-radius: 50%;
      }
      /*within page top most*/
      #cart-grand-total {
        color: red;
        margin-right: 0;
      }
      /*Value Inside cart icon*/
      #cart-total {
        content: "$";
        display: block;
        background-color: #800;
        opacity: 0.5;
        font-size: 14px;
        margin-top: 5px;
      }
      #cart-total::before {
        content: "$";
      }
      #checkout-page {
        /* position: fixed; */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        /* z-index: 1; */
      }
      #category-nav {
        position: sticky;
        width: 90%; 
        margin: 0 auto; 
        top: 1px;
        height: 3rem;
        overflow-x: auto;
        white-space: nowrap;
        background-color: #315;
        display: flex;
        align-items: center; 
        justify-content: space-around; 
        border-radius: 5px;
      }
      #category-nav a {
        display: inline-block;
        padding: 14px 16px;
        color: white;
        text-align: center;
        text-decoration: unset;
        font-size: 16px;
        flex-grow: 1; 
      }
      #category-nav a:hover {
        background-color: #d00;
        color: black;
      }
      h3 {
        margin: 0;
        padding: 0;
      }
      label {
      width: 100%;
      display: block;
      border: 1px solid black;
      margin: 5px;
      padding: 5px;
      }
      .message-box {
        font-size: 20px;
        justify-content: center;
        align-items: center;
        display: none;
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 10px;
        width: 14rem;
        height: 4rem;
        background-color: #2222f2;
        border: 1px solid #ccc;
        border-radius: 10px;
        animation: showMessage 2.5s ease-in-out forwards;
        z-index: 2;
      }
      .move-to-top-right {
        position: relative;
        animation: moveToTopRight 2s;
      }
      #product-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          padding: 10px;
      }
      .product-img {
          width: 10rem;
          height: 8rem;
      }
      .product-card {
          border: 2px solid #ddd;
          border-radius: 8px;
          margin: 10px;
          padding: 15px;
          width: 300px;
          box-shadow: 0 0 10px rgb(255, 0, 149);
      }
      #store-address {
        color: gold;
        margin: 8px 4px 2px 4px
      }
      #store-banner {
        width: 40%; 
        height: 8rem;
        border: 1px solid rgba(245, 241, 7, 0.815);
        order: 1; 
      }
      #store-front {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        justify-content: space-between; 
        align-items: center; 
        background-color: #222252;
        padding: 10px; 
      }
      #store-info {
        width: calc(40% - 20px); 
        color: yellow;
        display: flex;
        flex-direction: column;
        gap: 5px;
        text-align: center; 
        order: 2; 
      }
      #store-info > * {
        width: 100%;
        color: gold;
        margin: 4px 4px 4px 4px;
        border: 1px solid rgba(245, 241, 235, 0.815);
      }
      #store-logo {
        vertical-align: middle;
        margin-top: 1rem;
        width: 20%; 
        height: 6rem;
        border: 1px solid rgba(245, 241, 7, 0.815);
        order: 3; 
        margin-right: 5%; 
      }
      #store-msg-sticky {
        color: #fff;
        position: sticky;
        width: 100%;
        top: 3rem;
        height: 1.5rem;
        overflow: hidden;
        white-space: nowrap;
        background-color: #315;
      }
      #store-msg {
        text-indent: 150px;
        color: #fff;
        display: inline-block;
        margin: 1px 4px;
        padding-left: 100px;
        animation: marquee 25s linear infinite;
      }
      #store-web {
        color: gold;
      }
      #store-wsphone {
        color: gold;
        display: block;
      }
      .toggleOption {
        display: inline-block;
        margin-bottom: 10px;
        color: #fff; 
        padding: 10px;
        font-size: 14px;
        font-weight: bold;
        text-align: center;
        cursor: pointer;
        border: 2px solid #3498db;
        background: #d00;
        border-radius: 10px;
        transition: background-color 0.3s, color 0.3s;
      }
      .options-group label input[type="checkbox"] {
        margin-right: 5px;
      }
      /* Cart Item Quantity and Remove Buttons Row */
      .cart-item-actions {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between buttons */
        margin-top: 10px;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        justify-content: flex-end; /* Align buttons to the right */
      }

      .cart-item-actions button {
        padding: 8px 12px;
        font-size: 1rem;
        border-radius: 8px; /* Slightly more rounded */
        border: 2px solid #3498db; /* Consistent border */
        background-color: #d00; /* Matching remove button style */
        color: #fff;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
      }

      .cart-item-actions button:hover {
        background-color: #3498db;
        color: #fff;
      }
      
      .cart-item-qty {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Styles for checkout form */
      #formContainer {
        display: flex;
        flex-direction: column;
        align-items: flex-start; /* Align labels to the left */
        width: 100%;
        margin-bottom: 20px;
      }

      #formContainer label,
      #formContainer select,
      #formContainer button {
          width: 95%; /* Adjust width to fit within cart */
          margin-bottom: 10px; /* Space between form elements */
          padding: 8px;
          font-size: 1rem;
          border-radius: 5px;
      }
      #formContainer select {
        background-color: #333;
        color: #fff;
        border: 1px solid #555;
      }
      #dateTimeForm {
        display: flex; /* Use flex for horizontal alignment */
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }
      #dateTimeForm label {
        margin-bottom: 5px;
      }
      #dateTimeForm select {
        width: 95%;
      }
      #dateTimeForm button {
        width: auto; /* Allow submit button to size naturally */
        align-self: flex-end; /* Align submit button to the right */
        margin-top: 10px;
      }

      /* Cart Item Detailed Display in Checkout */
      .cart-item-checkout {
          display: flex;
          flex-direction: column;
          border: 1px solid #555;
          border-radius: 8px;
          padding: 10px;
          margin-bottom: 10px;
          background-color: #222;
      }

      .cart-item-summary {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 5px;
      }

      .cart-item-code-qty {
          font-weight: bold;
          font-size: 1.1rem;
      }

      .cart-item-prices {
          text-align: right;
      }

      .cart-item-options {
          font-size: 0.9rem;
          color: #bbb;
          margin-left: 10px;
      }
      .cart-item-options ul {
          list-style: none;
          padding: 0;
          margin: 0;
      }
      .cart-item-options li {
          margin-bottom: 2px;
      }
      .cart-item-controls {
          display: flex;
          justify-content: flex-end; /* Align buttons to the right */
          gap: 10px;
          margin-top: 10px;
      }
      .cart-item-controls button {
        padding: 6px 10px;
        font-size: 0.9rem;
        border-radius: 6px;
      }

      #checkout-store-unique {
        color: #f39c12; /* Orange color for emphasis */
        font-weight: bold;
        margin-bottom: 15px;
      }
      
      @media only screen and (max-width: 500px) {
        #store-front {
          text-align: center;
          flex-direction: column; 
        }
        #store-banner, #store-logo, #store-info {
            width: 80vw; 
            margin: 5px auto; 
            order: unset; 
        }
  
        #store-info {
          width: 70vw;
          gap: 3px;
        }
  
        #store-logo {
          justify-content: center;
          align-items: center;
          width: 6rem; 
          height: 6rem;
          border: 1px solid rgba(245, 241, 7, 0.815);
        }
          #category-nav {
            width: 90%;
          }
      }
      </style>
</head>
<body>
    <div id="cart-icon" role="button" aria-expanded="false" tabindex="0">
        <span id="cart-count">0</span>
        <span id="cart-total">$0.00</span>
    </div>
    <div id="checkout-page"></div>
    <div id="cart"></div>
    <div id="store-front"></div>
    <div id="announcement"></div>
    <nav id="category-nav">
        </nav>
    <div id="store-msg-sticky">
      <p id="store-msg">
      <span>This is text that will be replaced</span>
      </p>
    </div>
    <div id="product-container">
        </div>
    <div class="message-box">Tap the cart icon <br>to view order
    </div>
    <script>
    const stores = [
        { "StoreId": "Store01",
        "StoreUnique": "WLR330HomeMadeDishes",
        "StoreName": "Home Made Dishes",
        "StoreAddress": "330 Woodlands Road, Singapore",
        "LogoImg": "images/logo1.jpg",
        "StoreBannerImg": "images/StoreBanner4.jpg",
        "StoreWebsite": "www.homemadedishes.com",
        "GeoLocation":{"Lat": 1.4322294525406019, "Lon": 103.77419238281311},
        "StorePhone": "+6597358539",
        "PromotionMessage": "Welcome to Home Made Dishes, where we serve the best food we would eat! Try our signature Bing Burger, made with 100% beef patty, cheese, lettuce, tomato, onion, and our Special sauce. Or choose from our variety of other burgers, salads, sandwiches, and sides. Don't forget to add a drink and a Dessert to complete your meal. For a limited time, enjoy our Promotion of 10% off any burger combo. Hurry, this offer won't last long!",
        "Categories": ["All", "Lunch", "Dinner", "Promotion", "Special"],
        "Products": [
        { "Id": "AA01",
            "ProductName": "Bing Burger",
            "ProductImg" : "images/AA01.jpg",
            "Description": "Our signature burger, made with 100% beef patty, cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner", "Promotion"],
            "Price": 6.00,
            "Options": {
            "Dessert": { "No Thanks": 0.00,"ChengDo": 2.00 ,  "BoBo ChaCha": 3.20 }, 
            "AddOn": { "No Thanks": 0.00,  "Seafood Toufu": 2.00 ,  "Fish Cake": 3.20 , "Fruit Rojak": 2.10 ,  "Poach Egg": 1.20 },
            "Drink": { "Plain Water": 0.00 , "Mango Juice": 4.00, "Lime Juice": 0.50, "CokeZero 250mL": 0.50}
            },
            "Diet": ["HighProtein"]
        },
        {"Id": "AA02",
            "ProductName": "Veggie Burger",
            "ProductImg" : "images/AA02.jpg",
            "Description": "A delicious Vegetarian option, made with a soy-based patty, cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner", "Special"],
            "Price": 6.90,
            "Options": {
            "Drink": {"No Thanks": 0.00, "Mango Juice": 4.00, "Lime Juice": 0.50, "CokeZero 250mL": 0.50},          
            "Dessert": {"No Thanks": 0.00,"ChengDo": 2.00, "BoBo ChaCha": 3.20},
            "AddOn": { "Two Wings": 0.00, "Seafood Toufu": 2.00, "Fish Cake": 3.20, "Fruit Rojak": 2.10, "Poach Egg": 1.20}
            },
            "Diet": ["Vegetarian", "LowCarbo/Sugar"]
        },
        {"Id": "AA03",
            "ProductName": "Fish Squid Combo",
            "ProductImg" : "images/AA03.jpg",
            "Description": "A juicy chicken patty, cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner"],
            "Price": 4.50,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice": 4.00,"Lime Juice": 0.50,"CokeZero 250mL": 0.50},
            "Dessert": {"No Thanks": 0.00,"ChengDo": 2.00,"BoBo ChaCha": 3.20},
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 2.00,"Fish Cake": 3.20,"Fruit Rojak": 2.10,"Poach Egg": 1.20}
            },
            "Diet": ["HighProtein"]
        },
        {"Id": "AA04",
            "ProductName": "Pizza",
            "ProductImg" : "images/AA04.jpg",
            "Description": "A crispy fish fillet, cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner"],
            "Price": 3.90,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice": 4.00,"Lime Juice": 0.50,"CokeZero 250mL": 0.50},
            "Dessert": {"No Thanks": 0.00,"ChengDo": 2.00,"BoBo ChaCha": 3.20},
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 2.00,"Fish Cake": 3.20,"Fruit Rojak": 2.10,"Poach Egg": 1.20}
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "AA05",
            "ProductName": "Cheeseburger",
            "ProductImg" : "images/AA05.jpg",
            "Description": "A classic burger, made with 100% beef patty, double cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner"],
            "Price": 6.00,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice": 4.00,"Lime Juice": 0.50,"CokeZero 250mL": 0.50},
            "Dessert": {"No Thanks": 0.00,"ChengDo": 2.00,"BoBo ChaCha": 3.20},
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 2.00,"Fish Cake": 3.20,"Fruit Rojak": 2.10,"Poach Egg": 1.20}
            },
            "Diet": ["HighProtein"]
        },
        {"Id": "AA06",
            "ProductName": "Bacon Burger",
            "ProductImg" : "images/AA06.jpg",
            "Description": "A mouthwatering burger, made with 100% beef patty, bacon, cheese, lettuce, tomato, onion, and our Special sauce. Served with fries and a drink of your choice.",
            "Categories": ["All", "Lunch", "Dinner", "Special"],
            "Price": 6.10,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice": 4.00,"Lime Juice": 0.50,"CokeZero 250mL": 0.50},
            "Dessert": {"No Thanks": 0.00,"ChengDo": 2.00,"BoBo ChaCha": 3.20},
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 2.00,"Fish Cake": 3.20,"Fruit Rojak": 2.10,"Poach Egg": 1.20}
            },
            "Diet": ["HighProtein"]
        }
        ],
        "OperationHours": {
        "weekday": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
        "startTime": "8:00 AM",
        "endTime": "10:00 PM"
        }
    },
    {"StoreId": "Foodtopia",
        "StoreUnique": "WLS302HomeMadeFood",
        "StoreName": "Foodtopia",
        "StoreAddress": "302 Woodlands St31, Singapore",
        "LogoImg": "images/logoFoodtopia.jpg",
        "StoreBannerImg": "images/StoreBanner4.jpg",
        "StoreWebsite": "www.unixonds.github.io/ShopsInSG/?StoreID:Foodtopia",
        "GeoLocation":{"Lat": 1.387353973, "Lon": 103.8064571},
        "StorePhone": "+6591518277",
        "PromotionMessage": "All items at 20% discount while stock last. Welcome to Foodtopia, where we serve the best home made food that we love to eat! Try our creation of maki roll with our variety of fillings. Don't forget to add a side, and a drink to complete your meal. For a limited time, enjoy our lower price promotion. Hurry, this offer won't last long!",
        "Announcement":"For large advance order for celebration, we can deliver to home address. Delivery fee applies.",
        "Categories": ["All", "Featured", "Promotion", "Special"],
        "Products": [
        {"Id": "BB01S",
            "ProductName": "Standard Gimbab Roll",
            "ProductImg" : "images/BB01.jpg",
            "Description": "Specially created for Singaporean taste bud. You will want more! >Standard: Weight 70-80g, Cooked rice, Sesame Oil, Spinach,Sesame Oil salt.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 1.20,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "BB01P",
            "ProductName": "Premium Gimbab Roll",
            "ProductImg" : "images/BB01.jpg",
            "Description": "Specially created for Singaporean taste bud. You will want more! >Premium: Weight above 140g, cooked rice, crab stick, cucumber, egg, sesame Oil.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 2.40,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
         {"Id": "BB01L",
            "ProductName": "Luxury Gimbab Roll",
            "ProductImg" : "images/BB01.jpg",
            "Description": "Specially created for Singaporean taste bud. You will want more! >Luxury: total weight above 220g,cooked rice, crab stick, egg, Japanese Mayo, tuna, floss, cucumber, Sesame Oil.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 3.50,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "BB02S",
            "ProductName": "Standard Japanese Maki Roll",
            "ProductImg" : "images/BB02.jpg",
            "Description": "Flavored with sushi vinegar. Choice of >Standard: 70-80g, cooked rice, Crab stick, sushi vinegar.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 1.20,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "BB02P",
            "ProductName": "Premium Japanese Maki Roll",
            "ProductImg" : "images/BB02.jpg",
            "Description": "Flavored with sushi vinegar. >Premium: Above 120g, cooked rice, cucumber, egg, crab stick, Japanese mayonniase, sushi vinegar.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 2.20,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "BB02L",
            "ProductName": "Luxury Japanese Maki Roll",
            "ProductImg" : "images/BB02.jpg",
            "Description": "Flavored with sushi vinegar. >Luxury: extra large above 220g, cooked rice, Japanese Mayo, tuna, chicken floss, cucumber, sushi vinegar.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 3.50,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50},
            "Dessert": {"No Thanks": 0.00, "Coconut Green Bean": 2.00, "BoBo ChaCha": 2.40}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["LowCarbo/Sugar"]
        },
        {"Id": "BB03S",
            "ProductName": "Standard White Mua Chee",
            "ProductImg" : "images/BB03.jpg",
            "Description": "One of the favorite snacks that pleases all discerning taste buds. > Standard: 60-70g, powdered peanuts, sesame seeds",
            "Categories": ["All", "Featured", "Special"],
            "Price": 1.20,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,    "Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["Vegetarian", "LowCarbo/Sugar"]
        },
        {"Id": "BB03P",
            "ProductName": "Premium Mua Chee",
            "ProductImg" : "images/BB03.jpg",
            "Description": "One of the favorite snacks that pleases all discerning taste buds. > Upsize to Black or White Premium: Above 120g, Powered peanut, choice of black or white sesame",
            "Categories": ["All", "Featured", "Special"],
            "Price": 2.20,
            "Options": {
            "Variation": {"White": 0.00,"Black": 0.00},
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,    "Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["Vegetarian", "LowCarbo/Sugar"]
        },
        {"Id": "BB03L",
            "ProductName": "Black & White Mua Chee",
            "ProductImg" : "images/BB03.jpg",
            "Description": "One of the favorite snacks that pleases all discerning taste buds. Upsize to Black and White > Luxury: extra Large size mixed black & white, above 200g, mixed black and white sesame.",
            "Categories": ["All", "Featured", "Special"],
            "Price": 3.20,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,    "Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50}/*,
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}*/
            },
            "Diet": ["Vegetarian", "LowCarbo/Sugar"]
        }/*,
        {"Id": "BB04",
            "ProductName": "Chicken Bak Kwa Sandwich",
            "ProductImg" : "images/BB04.jpg",
            "Description": "A tasty sandwich, with Chicken Bak Kwa meat, lettuce and cucumber. Cheese or Mayonnaise to your sandwich. Options to add drink of your choice.",
            "Categories": ["All", "Breakfast", "Lunch", "Dinner"],
            "Price": 4.50,
            "Options": {
            "Drink": {"No Thanks": 0.00,"Mango Juice 250mL": 2.50,"Lime Juice": 1.50,"CokeZero 250mL": 1.00,"Green Milk Tea 300mL": 1.50,"Blue Berry Milk Tea 300mL":1.50}/*,
             "Cheese": {"No Thanks": 0.00,"Mozerella": 1.80,"Cheddar": 1.80},
            "AddOn": {"No Thanks": 0.00,"Seafood Toufu": 1.00,"Fish Cake": 2.50,"Fruit Rojak": 2.10,"Fried Egg": 0.80}
            },
            "Diet": ["HighProtein"]
        }*/
        ],
        "OperationHours": {
        "weekday": "Monday to Sunday",
        "startTime": "8:00 AM",
        "endTime": "10:00 PM"
        }
    },
    { "StoreId": "LionCityArtGallery",
        "StoreUnique": "LionCityArtGalleryTGM01",
        "StoreName": "Lion City Art Gallery",
        "StoreAddress": "2 Orchard, Singapore",
        "LogoImg": "images/logo6.jpg",
        "StoreBannerImg": "images/StoreBanner3.jpg",
        "StoreWebsite": "www.lion-city-art-gallery.com",
        "GeoLocation":{"Lat": 1.387353973, "Lon": 103.8064571},
        "StorePhone": "+6590011383",
        "PromotionMessage": "Welcome to Lion City Art Gallery Singapore, where we curated special peices of arts for you. Quote 'LCAG-Jun' to get 10% discount. Hurry, this offer won't last long!",
        "Categories": ["All", "Abstract", "Oil Paint", "Promotion", "Photography", "Modern"],
        "Products": [
        {"Id": "Art001",
            "ProductName": "Koi In Pond- Blue Sky Reflection",
            "ProductImg" : "images/Art1.jpg",
            "Description": "Done by local artist <Name>. <name> has been in the art scene for 15 years. <name> was awarded the Young Artist Award in 2018.",
            "Categories": ["All", "Abstract", "Oil Paint", "Promotion"],
            "Price": 12000.00,
            "Options": {
            "Frame": [{"No Frame": 0.00,"Simple Frame": 200.00,"Gold Plated Frame": 500.00}], 
            "AddOn": [{"No Thanks": 0.00, "Signed by Artist": 500.00}],
            "Shipment": [{"No Thanks": 0.00,"Local Delivery": 20.00, "International Shipping": 500.00}]
            },
            "Diet": ["No restriction"]
        },
        {"Id": "Art002",
            "ProductName": "Shophouse In Rain",
            "ProductImg" : "images/Art2.jpg",
            "Description": "Done by local artist <Name>. <name> has been in the art scene for 15 years. <name> was awarded the Young Artist Award in 2018.",
            "Categories": ["All", "Abstract", "Oil Paint", "Special"],
            "Price": 8000.00,
            "Options": {
            "Frame": [{"No Frame": 0.00,"Simple Frame": 200.00,"Gold Plated Frame": 500.00}], 
            "AddOn": [{"No Thanks": 0.00, "Signed by Artist": 500.00}],
            "Shipment": [{"No Thanks": 0.00,"Local Delivery": 20.00, "International Shipping": 500.00}]
            },
            "Diet": ["No restriction"]
        },
        {"Id": "Art003",
            "ProductName": "My Neighbor's Cat",
            "ProductImg" : "images/Art3.jpg",
            "Description": "Done by local artist <Name>. <name> has been in the art scene for 15 years. <name> was awarded the Young Artist Award in 2018.",
            "Categories": ["All", "Abstract", "Photography"],
            "Price": 6000.00,
            "Options": {
            "Frame": [{"No Frame": 0.00,"Simple Frame": 200.00,"Gold Plated Frame": 500.00}], 
            "AddOn": [{"No Thanks": 0.00, "Signed by Artist": 500.00}],
            "Shipment": [{"No Thanks": 0.00,"Local Delivery": 20.00, "International Shipping": 500.00}]
            },
            "Diet": ["No restriction"]
        },
        {"Id": "Art004",
            "ProductName": "Home",
            "ProductImg" : "images/Art4.jpg",
            "Description": "Done by local artist <Name>. <name> has been in the art scene for 15 years. <name> was awarded the Young Artist Award in 2018.",
            "Categories": ["All", "Modern", "Photography"],
            "Price": 10000.00,
            "Options": {
            "Frame": [{"No Frame": 0.00,"Simple Frame": 200.00,"Gold Plated Frame": 500.00}], 
            "AddOn": [{"No Thanks": 0.00, "Signed by Artist": 500.00}],
            "Shipment": [{"No Thanks": 0.00,"Local Delivery": 20.00, "International Shipping": 500.00}]
            },
            "Diet": ["No restriction"]
        }
        ],
        "OperationHours": {
        "weekday": ["Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
        "startTime": "10:00 AM",
        "endTime": "6:00 PM"
        }
    }
    ];

    let cart = [];
    let currentStoreId = '';
    let selectedOptions = {}; // To store selected options for the currently active product

    // --- Utility Functions (could be in util.js, but kept here for context) ---
    function getUrlParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(param => {
            const pair = param.split('=');
            params[pair[0]] = pair[1];
        });
        return params;
    }

    function generateOrderNo() {
      var rdmString = "";
      for( ; rdmString.length < 4; rdmString  += Math.random().toString(36).substr(2));
      var d = new Date();
      var mth=("0" + d.getDate()).slice(-2);
      var date=("0" + (d.getMonth()+1)).slice(-2);
      //var dateStr = String('-'+today.getDate()+today.toLocaleString('default', { month: 'short' }));
      var dateStr = String('-'+mth+date+ d.getHours()+d.getMinutes());
      return rdmString.substr(0, 4).toLocaleUpperCase()+dateStr 
    }

    function getProductCard(productId) {
        const productCards = document.querySelectorAll('.product-card');
        for (const card of productCards) {
            const h3ProductID = card.querySelector('h3').textContent.trim();
            if (h3ProductID === productId) {
                return card;
            }
        }
        return null;
    }

    // --- Cart Management Functions ---
    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        localStorage.setItem('cartTotal', document.getElementById('cart-total').textContent);
        localStorage.setItem('cartCount', document.getElementById('cart-count').textContent);
    }

    function loadCart() {
        const storedCart = localStorage.getItem('cart');
        const storedCartTotal = localStorage.getItem('cartTotal');
        const storedCartCount = localStorage.getItem('cartCount');

        if (storedCart) {
            cart = JSON.parse(storedCart);
            renderCartContent(); // Render initial cart content
        }
        if (storedCartTotal) {
            document.getElementById('cart-total').textContent = storedCartTotal;
        }
        if (storedCartCount) {
            document.getElementById('cart-count').textContent = storedCartCount;
        }
    }

    function renderCartContent(goTop) {
        const cartDiv = document.getElementById('cart');
        cartDiv.innerHTML = ''; // Clear previous content
        const currentStore = stores.find(s => s.StoreId === currentStoreId);
        
        let grandTotal = 0;

        if (cart.length === 0) {
            cartDiv.innerHTML = `
                <div class="cart-header-buttons">
                    <button id="go-back-shopping" onclick="toggleCart()">Go Back Shopping</button>
                    <p id="cart-close">X</p>
                </div>
                <p>Your cart is empty.</p>
            `;
        } else {
            let cartItemsHtml = '';
            cart.forEach((item, index) => {
                const itemTotal = (item.price + item.optionsTotal) * item.quantity; 
                grandTotal += itemTotal;

                cartItemsHtml += `
                    <div class="cart-item">
                        <p>${item.productId}>${item.productName} ($${item.price.toFixed(2)} / unit)</p>
                        
                        <ul>
                            ${Object.entries(item.selectedOptions).map(([group, options]) => {
                                if (Array.isArray(options)) {
                                    return options.map(opt => {
                                        if (opt.name !== 'No Thanks') {
                                            return `<li>${group}: ${opt.name} ($${opt.price.toFixed(2)})</li>`;
                                        }
                                        return '';
                                    }).join('');
                                } else if (options.name && options.price !== undefined) { 
                                    if (options.name !== 'No Thanks') {
                                        return `<li>${group}: ${options.name} ($${options.price.toFixed(2)})</li>`;
                                    }
                                }
                                return ''; 
                            }).join('')}
                        </ul>
                        <div>
                          <p>Item Total: $${itemTotal.toFixed(2)}</p>
                          
                        </div>
                        <div class="cart-item-actions">
                            <div class="cart-item-qty">
                                <button class="decrease-qty-btn" data-index="${index}">-</button>
                                
                                <button class="increase-qty-btn" data-index="${index}">+</button>
                            </div>
                            <button class="remove-from-cart-btn" data-index="${index}">Remove</button>
                            <span>Qty = ${item.quantity}</span>
                        </div>
                        <hr>
                    </div>
                `;
            });

            cartDiv.innerHTML = `
                <div class="cart-header-buttons">
                    <button id="proceed-to-checkout-btn">Proceed to Checkout</button>
                    <p id="cart-close">X</p>
                </div>
                <h3>Grand Total: $${grandTotal.toFixed(2)}</h3>
                ${cartItemsHtml}
            `;
            
            document.getElementById('proceed-to-checkout-btn').addEventListener('click', renderCheckoutContent);
        }
        
        document.getElementById('cart-count').textContent = cart.length;
        document.getElementById('cart-total').textContent = `$${grandTotal.toFixed(2)}`;
        saveCart();

        // Add event listeners for remove, increase, decrease buttons
        document.querySelectorAll('.remove-from-cart-btn').forEach(button => {
            button.addEventListener('click', removeFromCart);
        });
        document.querySelectorAll('.increase-qty-btn').forEach(button => {
            button.addEventListener('click', increaseQuantity);
        });
        document.querySelectorAll('.decrease-qty-btn').forEach(button => {
            button.addEventListener('click', decreaseQuantity);
        });

        // Re-attach listener for cart close button
        document.getElementById('cart-close').addEventListener('click', toggleCart);
        goTop==="No" ? "" : window.scroll(0, 0);
    }

    function renderCheckoutContent() {
        const cartDiv = document.getElementById('cart');
        cartDiv.innerHTML = ''; // Clear previous content for checkout view

        const currentStore = stores.find(s => s.StoreId === currentStoreId);
        let grandTotal = 0;

        // Calculate grand total for display
        cart.forEach(item => {
            grandTotal += (item.price + item.optionsTotal) * item.quantity;
        });

        cartDiv.innerHTML = `
            <div id="formContainer">
            <div class="cart-header-buttons">
                <button type="submit" id="send-order-btn">Send Order to WhatsApp</button>
                <p id="cart-close">X</p>
            </div>

            
                <label for="deliveryOptions">Delivery Options:</label>
                <select id="deliveryOptions">
                    <option value="Self Pick Up">Self Pick 8am-9pm 302 Woodlands St 31</option>
                    <option value="By MeetUp Marsiling MRT">MeetUp Marsiling MRT($1.00)</option>
                    <option value="By Appointment">To Arrange Time/Place Via Text($2.50)</option>
                </select>  
                <div id="dateTimeForm">
                    <h4>Enter Date,Time for Marsiling Mrt MeetUp Only</h4>
                    <label for="dateInput">Date: For Marsiling Mrt MeetUp Only</label>
                    <select id="hourInput" required>
                        <option value="" selected>Select a date and time</option>
                    </select>
                </div>
            </div>
            
            <p id="checkout-store-unique">${currentStore ? currentStore.StoreUnique : ''}</p>
            <h3 id="cart-grand-total">Grand Total: $${grandTotal.toFixed(2)}</h3>
            <hr>
        `;
             
        // Populate time options and set initial state
        populateTimeOptions();
        updateMeetupDateTimeState(); // Set initial visibility based on default selection

        // Add event listener for delivery options change
        document.getElementById('deliveryOptions').addEventListener('change', updateMeetupDateTimeState);

        cart.forEach((item) => {
            const itemTotal = (item.price + item.optionsTotal) * item.quantity;
            const itemDiv = document.createElement('div');
            itemDiv.classList.add('cart-item-checkout');
            itemDiv.innerHTML = `
                <div class="cart-item-summary">
                    <span class="cart-item-code-qty">${item.productId} Qty= ${item.quantity}</span>
                    <span class="cart-item-prices">$${itemTotal.toFixed(2)} (${item.price.toFixed(2)})</span>
                </div>
                <div class="cart-item-options">
                    <ul>
                        ${Object.entries(item.selectedOptions).map(([group, options]) => {
                            if (Array.isArray(options)) {
                                return options.map(opt => {
                                    if (opt.name !== 'No Thanks') {
                                        return `<li>${group}: ${opt.name} ($${opt.price.toFixed(2)})</li>`;
                                    }
                                    return '';
                                }).join('');
                            } else if (options.name && options.price !== undefined) { 
                                if (options.name !== 'No Thanks') {
                                    return `<li>${group}: ${options.name} ($${options.price.toFixed(2)})</li>`;
                                }
                            }
                            return ''; 
                        }).join('')}
                    </ul>
                </div>
                <div class="cart-item-controls">
                    <button class="decrease-qty-btn" data-index="${cart.indexOf(item)}">-</button>
                    <button class="increase-qty-btn" data-index="${cart.indexOf(item)}">+</button>
                    <button class="remove-from-cart-btn" data-index="${cart.indexOf(item)}">Remove</button>
                </div>
            `;
            cartDiv.appendChild(itemDiv);
        });

        // Re-attach event listeners for close, remove, increase, decrease buttons
        document.getElementById('cart-close').addEventListener('click', toggleCart);
        document.getElementById('send-order-btn').addEventListener('click', sendOrderToWhatsApp);

        document.querySelectorAll('.remove-from-cart-btn').forEach(button => {
            button.addEventListener('click', removeFromCart);
        });
        document.querySelectorAll('.increase-qty-btn').forEach(button => {
            button.addEventListener('click', increaseQuantity);
        });
        document.querySelectorAll('.decrease-qty-btn').forEach(button => {
            button.addEventListener('click', decreaseQuantity);
        });
    }

/*// Get references to the elements
const deliveryOptionsEle = document.getElementById("deliveryOptions");
const hourInputEle = document.getElementById("hourInput");
const submitButtonEle = document.querySelector("#dateTimeForm button[type='submit']"); // Select the submit button within the form
*/
// Function to initialize and handle the state of hourInput and submitButton
/*function updateMeetupDateTimeState() {
    // Get references to the elements
    const deliveryOptionsEle = document.getElementById("deliveryOptions");
    const hourInputEle = document.getElementById("hourInput");
    const submitButtonEle = document.getElementById("send-order-btn"); // Select the submit button within the form  
    // Check if the selected option in deliveryOptions is "By MeetUp Marsiling MRT"
    if (deliveryOptionsEle.value === "By MeetUp Marsiling MRT") {
        hourInputEle.disabled = false; // Enable the hourInput select
        //submitButtonEle.disabled = false; // Enable the submit button
    } else {
        hourInputEle.disabled = true; // Disable the hourInput select
        //submitButtonEle.disabled = true; // Disable the submit button
        // Optionally, reset the hourInput to its placeholder
        hourInputEle.value = ""; 
    }
}*/

// Attach an event listener to the deliveryOptions select
//deliveryOptionsEle.addEventListener("change", updateMeetupDateTimeState);

// --- Your existing populateTimeOptions function (with slight modification for hourInput ID) ---
    function populateTimeOptions() {
        const hourInput = document.getElementById("hourInput"); // Corrected ID
        hourInput.innerHTML = '<option value="" disabled selected>Select a date and time</option>'; // Corrected placeholder line

        const now = new Date();
        let currentOptionTime = new Date(now.getTime() + 20 * 60 * 1000); // Start 20 minutes from now

        const allowedHours = [12, 13, 18, 19, 20, 21]; // 12 PM, 1 PM, 6 PM, 7 PM, 8 PM, 9 PM

        for (let i = 0; i < 36; i++) {
            let hour = currentOptionTime.getHours();
            let minute = currentOptionTime.getMinutes();

            // Round up to the next 30-minute interval (0 or 30)
            if (minute > 30) {
                currentOptionTime.setHours(hour + 1);
                currentOptionTime.setMinutes(0);
            } else if (minute > 0 && minute <= 30) {
                currentOptionTime.setMinutes(30);
            } else if (minute < 0) { // Should not happen but for safety
                currentOptionTime.setMinutes(0);
            }

            hour = currentOptionTime.getHours();
            minute = currentOptionTime.getMinutes();
            
            // Adjust for allowed hours
            while (!allowedHours.includes(hour) || (hour === 21 && minute > 30)) {
                if (hour >= 21 && minute >= 30) { // If past 9:30 PM, go to next day 12 PM
                    currentOptionTime.setDate(currentOptionTime.getDate() + 1);
                    currentOptionTime.setHours(12);
                    currentOptionTime.setMinutes(0);
                } else { // Increment hour until an allowed hour is found
                    currentOptionTime.setHours(hour + 1);
                    currentOptionTime.setMinutes(0); // Reset minutes when changing hour
                }
                hour = currentOptionTime.getHours();
                minute = currentOptionTime.getMinutes();
            }

            // Format the date and time
            const day = currentOptionTime.getDate();
            const month = currentOptionTime.toLocaleString('en-US', {
                month: 'long'
            });
            const year = currentOptionTime.getFullYear();
            const formattedHour = hour > 12 ? hour - 12 : hour;
            const ampm = hour >= 12 ? 'pm' : 'am';
            const formattedMinute = minute.toString().padStart(2, '0');

            const optionText = `${day} ${month} ${year} ${formattedHour}:${formattedMinute}${ampm}`;
            const optionValue = currentOptionTime.toISOString(); // Use ISO string for value for easy parsing later

            const option = document.createElement("option");
            option.value = optionValue;
            option.textContent = optionText;
            hourInput.appendChild(option);

            // Increment for the next option (30 minutes)
            currentOptionTime.setMinutes(currentOptionTime.getMinutes() + 30);
        }
    }

    // Call populateTimeOptions once to fill the hourInput initially
    //populateTimeOptions(); 

    // Call updateMeetupDateTimeState once on page load to set the initial state
    //document.addEventListener("DOMContentLoaded", updateMeetupDateTimeState);

    function updateMeetupDateTimeState() {
        const deliveryOption = document.getElementById('deliveryOptions').value;
        const dateTimeForm = document.getElementById('dateTimeForm');

        if (deliveryOption === "By MeetUp Marsiling MRT") {
            dateTimeForm.style.display = 'block'; // Show the date/time picker
            document.getElementById('hourInput').setAttribute('required', 'true');
        } else {
            dateTimeForm.style.display = 'none'; // Hide the date/time picker
            document.getElementById('hourInput').removeAttribute('required');
        }
    }


    function increaseQuantity(event) {
        const index = parseInt(event.target.dataset.index);
        if (cart[index]) {
            cart[index].quantity++;
            if (document.getElementById('send-order-btn')) { // If in checkout view
                renderCheckoutContent();
            } else {
                renderCartContent("No");
            }
        }
    }

    function decreaseQuantity(event) {
        const index = parseInt(event.target.dataset.index);
        if (cart[index]) {
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
            } else {
                cart.splice(index, 1); 
            }
            if (document.getElementById('send-order-btn')) { // If in checkout view
                renderCheckoutContent();
            } else {
                renderCartContent("No");
            }
        }
    }

    function sendOrderToWhatsApp() {
        const selectedHourIndex=(document.getElementById('hourInput').selectedIndex)
        const deliveryChosen = document.getElementById('deliveryOptions').value;
        if (selectedHourIndex < 1 && deliveryChosen.includes("MeetUp")){
            alert("Please select the required meetup time");
            return;
        }
        const store = stores.find(s => s.StoreId === currentStoreId);
        if (!store) {
            alert("Store information not found.");
            return;
        }
        let orderId = generateOrderNo();
        let message = `Hello ${store.StoreName},\nMy order details:ID= ${generateOrderNo()}\n`;
        let grandTotal = 0;

        cart.forEach((item, index) => {
            const itemTotal = (item.price + item.optionsTotal) * item.quantity;
            grandTotal += itemTotal;
            message += `${index + 1}. ${item.productId}>${item.productName} Qty=${item.quantity} - $${itemTotal.toFixed(2)} ($${item.price.toFixed(2)}/unit)\n`;
            
            Object.entries(item.selectedOptions).forEach(([group, options]) => {
                if (Array.isArray(options)) {
                    options.forEach(opt => {
                        if (opt.name !== 'No Thanks') { 
                            message += `   - ${group}: ${opt.name} ($${opt.price.toFixed(2)})\n`;
                        }
                    });
                } else if (options.name && options.price !== undefined && options.name !== 'No Thanks') {
                    message += `   - ${group}: ${options.name} ($${options.price.toFixed(2)})\n`;
                }
            });
            message += `\n`; // Add extra line for readability
        });

        message += `Grand Total: $${grandTotal.toFixed(2)}\n\n`;
        
        const deliveryOption = document.getElementById('deliveryOptions').value;
        message += `Delivery Option: ${deliveryOption}\n`;

        // Add date/time if selected and visible
        const dateTimeInput = document.getElementById('hourInput');
        const dateTimeForm = document.getElementById('dateTimeForm');
        if (dateTimeForm.style.display !== 'none' && dateTimeInput && dateTimeInput.value) {
            message += `Selected Date/Time: ${dateTimeInput.value}\n`;
        }
        
        message += `\nThank you!`;
        console.log(message);
        const whatsappUrl = `https://wa.me/${store.StorePhone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
        // remove item in localStorage and cart element
        localStorage.removeItem('cart');
        cart = []; // Add this line to clear the cart variable in memory
        const cartDiv = document.getElementById('cart');
        cartDiv.innerHTML = ''; // Clear previous content
        //   const orderedElements = document.querySelectorAll('.ordered');
        //   orderedElements.forEach((element) => {
        //     element.remove();
        //   });
        document.getElementById('cart-total').textContent=0;
        document.getElementById('cart-count').textContent=0;
        //document.getElementById("cart-grand-total").textContent="$0";
         //end whatsapp check out
        //document.getElementById("checkOutBtn").style.display = "none";
        //document.getElementById("cart").style.display = "none";
        //document.getElementById("cart-close").style.display = "none";
    }


    function addProductToCart(productId) {
        const store = stores.find(s => s.StoreId === currentStoreId);
        const product = store.Products.find(p => p.Id === productId);

        if (!product) {
            console.error('Product not found:', productId);
            return;
        }

        const productCard = getProductCard(productId);
        const productSpecificOptions = {};
        let optionsTotalPrice = 0;

        // Iterate through all option groups for the current product
        for (const groupName in product.Options) {
            const groupInputs = productCard.querySelectorAll(`input[name="${productId}_${groupName}"]`);
            if (groupName === 'Drink') {
                const selectedDrinkOptions = [];
                groupInputs.forEach(input => {
                    if (input.checked) {
                        const optionName = input.value;
                        const optionPrice = parseFloat(input.dataset.price);
                        selectedDrinkOptions.push({ name: optionName, price: optionPrice });
                        optionsTotalPrice += optionPrice;
                    }
                });
                if (selectedDrinkOptions.length > 0) {
                    productSpecificOptions[groupName] = selectedDrinkOptions;
                }
            } else {
                groupInputs.forEach(input => {
                    if (input.checked) {
                        const optionName = input.value;
                        const optionPrice = parseFloat(input.dataset.price);
                        productSpecificOptions[groupName] = { name: optionName, price: optionPrice };
                        optionsTotalPrice += optionPrice;
                    }
                });
            }
        }
        
        // Ensure "No Thanks" is handled for groups that default to it if no other option is selected
        for (const groupName in product.Options) {
            if (!productSpecificOptions[groupName] || (Array.isArray(productSpecificOptions[groupName]) && productSpecificOptions[groupName].length === 0)) {
                const firstOptionObject = product.Options[groupName] && product.Options[groupName][0];
                if (firstOptionObject && firstOptionObject.hasOwnProperty("No Thanks")) {
                    if (groupName === 'Drink') {
                        productSpecificOptions[groupName] = [{ name: 'No Thanks', price: 0 }];
                    } else {
                        productSpecificOptions[groupName] = { name: 'No Thanks', price: 0 };
                    }
                }
            }
        }

        // Check if the product is already in the cart
        const existingItemIndex = cart.findIndex(item => 
            item.productId === productId && 
            JSON.stringify(item.selectedOptions) === JSON.stringify(productSpecificOptions)
        );

        if (existingItemIndex > -1) {
            cart[existingItemIndex].quantity++;
        } else {
            cart.push({
                productId: productId,
                productName: product.ProductName,
                price: product.Price,
                quantity: 1,
                selectedOptions: productSpecificOptions,
                optionsTotal: optionsTotalPrice
            });
        }
        
        renderCartContent("No");
        showMessageBox();
        //toggleOption(productId, 'none'); 
        clearAllOptionsExceptForProduct(productId); 
        selectedOptions = {}; 
    }

    function removeFromCart(event) {
        const index = parseInt(event.target.dataset.index);
        cart.splice(index, 1);
        if (document.getElementById('send-order-btn')) { // If in checkout view
            renderCheckoutContent();
        } else {
            renderCartContent("No");
        }
    }

    function toggleCart() {
        const cartDiv = document.getElementById('cart');
        const cartIcon = document.getElementById('cart-icon');
        
        const isCartHidden = cartDiv.style.display === 'none' || cartDiv.style.display === '';
        
        if (isCartHidden) {
            cartDiv.style.display = 'block';
            cartIcon.setAttribute('aria-expanded', 'true');
            renderCartContent(); // Always render initial cart content when opening
        } else {
            cartDiv.style.display = 'none';
            cartIcon.setAttribute('aria-expanded', 'false');
        }
    }

    // --- UI and Display Functions ---
    function showMessageBox() {
        const messageBox = document.querySelector('.message-box');
        messageBox.style.display = 'flex';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 2500);
    }

    function displayStoreInfo(store) {
        const storeFront = document.getElementById('store-front');
        storeFront.innerHTML = `
            <img id="store-banner" src="${store.StoreBannerImg}" alt="${store.StoreName} Banner">
            <div id="store-info">
                <h2 id="store-name">${store.StoreName}</h2>
                <span id="store-address">${store.StoreAddress}</span>
                <span id="store-wsphone">Whatsapp/Phone: ${store.StorePhone}</span>
                <span id="store-web"><a href="${store.StoreWebsite}" target="_blank">${store.StoreWebsite}</a></span>
            </div>
            <img id="store-logo" src="${store.LogoImg}" alt="${store.StoreName} Logo">
        `;
        document.getElementById('store-msg').textContent = store.PromotionMessage;
        document.getElementById('announcement').innerHTML = `
         <span> ${store.Announcement}</span>
          <a href="https://wa.me/6591234567?text=Large%20Order%20Enquiry%0AMy%20address%20is%20.." target="_blank" class="whatsapp-link">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-icon">
          </a>
        `;
    }

    function displayProducts(products) {
        const productContainer = document.getElementById('product-container');
        productContainer.innerHTML = '';
        products.forEach(product => {
            const productCard = document.createElement('div');
            productCard.classList.add('product-card');
            // Split the message into lines by replacing ">" with newlines
            let productMsg = product.Description.replace(/>/g, '<br>• ');

            productCard.innerHTML = `
                <img class="product-img" src="${product.ProductImg}" alt="${product.ProductName}">
                <h3>${product.Id}</h3>
                <h4>${product.ProductName}</h4>
                <p>${productMsg}</p>
                <p>Price: $${product.Price.toFixed(2)}</p>
                <button class="toggleOption" data-product-id="${product.Id}">Options</button>
                <div class="options-container" style="display: none;"></div>
                <button class="add2Cart" data-product-id="${product.Id}">Add to Cart</button>
            `;

            const optionsContainer = productCard.querySelector('.options-container');
            for (const optionGroup in product.Options) {
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('options-group');
                groupDiv.innerHTML = `<h5>${optionGroup}:</h5>`;
                // Iterate directly over the product.Options[optionGroup] object
                Object.entries(product.Options[optionGroup]).forEach(([optionName, optionPrice]) => {
                    const label = document.createElement('label');
                    const inputType = optionGroup === 'Drink' ? 'checkbox' : 'radio';
                    const isChecked = (optionPrice === 0); // Default select "No Thanks"

                    label.innerHTML = `
                        <input type="${inputType}" name="${product.Id}_${optionGroup}" value="${optionName}" data-price="${optionPrice}" ${isChecked ? 'checked' : ''}>
                        ${optionName} ($${optionPrice.toFixed(2)})
                    `;
                    groupDiv.appendChild(label);
                    
                });

                optionsContainer.appendChild(groupDiv);
            }
            productContainer.appendChild(productCard);
        });
        // Add event listeners for toggle and add to cart buttons
        document.querySelectorAll('.toggleOption').forEach(button => {
            button.addEventListener('click', (event) => {
                const productId = event.target.dataset.productId;
                toggleOption(productId);
            });
        });
        document.querySelectorAll('.add2Cart').forEach(button => {
            button.addEventListener('click', (event) => {
                const productId = event.target.dataset.productId;
                addProductToCart(productId);
            });
        });
        // Add event listeners for option changes
        document.querySelectorAll('.options-group input').forEach(input => {
            input.addEventListener('change', handleOptionChange);
        });
    }

    function toggleOption(productId) {
        const productCard = getProductCard(productId);
        if (!productCard) return;

        const optionsContainer = productCard.querySelector('.options-container');
        const isHidden = optionsContainer.style.display === 'none' || optionsContainer.style.display === '';

        if (isHidden) {
            clearAllOptionsExceptForProduct(productId);
        }

        optionsContainer.style.display = isHidden ? 'block' : 'none';

        const toggleButton = productCard.querySelector('.toggleOption');
        toggleButton.textContent = isHidden ? 'Hide Options' : 'Options';

        if (isHidden) {
            selectedOptions = {}; 
            productCard.querySelectorAll('.options-group input').forEach(input => {
                input.checked = false;
            });
        }
    }

    function clearAllOptionsExceptForProduct(productIdToKeep = null) {
        document.querySelectorAll('.product-card').forEach(card => {
            const currentProductId = card.querySelector('h3').textContent.trim();
            const optionsContainer = card.querySelector('.options-container');
            const toggleButton = card.querySelector('.toggleOption');

            if (productIdToKeep && currentProductId === productIdToKeep) {
                if (optionsContainer.style.display !== 'block') { 
                    optionsContainer.style.display = 'none';
                    toggleButton.textContent = 'Options';
                    card.querySelectorAll('.options-group input').forEach(input => {
                        input.checked = false;
                    });
                }
            } else {
                optionsContainer.style.display = 'none';
                toggleButton.textContent = 'Options';
                card.querySelectorAll('.options-group input').forEach(input => {
                    input.checked = false;
                });
            }
        });
    }


    function handleOptionChange(event) {
        const input = event.target;
        const groupName = input.name.split('_')[1];
        const productId = input.name.split('_')[0];
        const productCard = getProductCard(productId);

        if (groupName === 'Drink') {
            if (input.value === 'No Thanks' && input.checked) {
                const otherDrinkOptions = Array.from(productCard.querySelectorAll(`input[name="${input.name}"]:checked`))
                                            .filter(opt => opt !== input && parseFloat(opt.dataset.price) > 0);

                if (otherDrinkOptions.length > 0) {
                    const confirmClear = confirm("Selecting 'No Thanks' will remove other selected drink options. Do you agree?");
                    if (confirmClear) {
                        otherDrinkOptions.forEach(opt => opt.checked = false);
                    } else {
                        input.checked = false; 
                    }
                }
            } else if (input.value !== 'No Thanks' && input.checked) {
                const noThanksInput = productCard.querySelector(`input[name="${input.name}"][value="No Thanks"]`);
                if (noThanksInput && noThanksInput.checked) {
                    noThanksInput.checked = false;
                }
            }
        } else {
            if (input.type === 'radio' && input.checked) {
                productCard.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                    if (radio !== input) {
                        radio.checked = false;
                    }
                });
            }
        }
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        loadCart();

        const urlParams = getUrlParams();
        const storeIdFromUrl = urlParams['StoreID'];

        const defaultStore = stores[1];
        currentStoreId = storeIdFromUrl || defaultStore.StoreId;

        const store = stores.find(s => s.StoreId === currentStoreId);
        if (store) {
            displayStoreInfo(store);
            displayProducts(store.Products);
            createCategoryNavigation(store.Categories);
        } else {
            console.error('Store not found. Displaying default store.');
            displayStoreInfo(defaultStore);
            displayProducts(defaultStore.Products);
            createCategoryNavigation(defaultStore.Categories);
        }

        document.getElementById('cart-icon').addEventListener('click', toggleCart);
    });

    function createCategoryNavigation(categories) {
        const categoryNav = document.getElementById('category-nav');
        categoryNav.innerHTML = '';
        categories.forEach(category => {
            const link = document.createElement('a');
            link.href = `#${category}`;
            link.textContent = category;
            link.addEventListener('click', (event) => {
                event.preventDefault();
                filterProductsByCategory(category);
            });
            categoryNav.appendChild(link);
        });
    }

    function filterProductsByCategory(category) {
        const store = stores.find(s => s.StoreId === currentStoreId);
        if (!store) return;

        let filteredProducts;
        if (category === 'All') {
            filteredProducts = store.Products;
        } else {
            filteredProducts = store.Products.filter(product =>
                product.Categories.includes(category)
            );
        }
        displayProducts(filteredProducts);
    }

    </script>
</body>
</html>


    </script>
</body>
</html>

